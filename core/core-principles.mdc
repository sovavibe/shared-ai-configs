---
description: 'Core TypeScript and React principles: SOLID, immutability, type safety'
globs: ['src/**/*.ts', 'src/**/*.tsx']
alwaysApply: false
---

# Core Development Principles

## Use Existing Solutions First

**CRITICAL**: Never create custom implementations when proven solutions exist.

| Step | Action                                 |
| ---- | -------------------------------------- |
| 1    | Search `context7` for libraries        |
| 2    | Check `package.json` for existing deps |
| 3    | Search `.cursor/rules/` for patterns   |
| 4    | Only then create custom solution       |

See: @existing-solutions-first.mdc

## AI-First Workflow: Minimize Scripts

**CRITICAL**: AI workflow via MCP is priority. Minimize scripts to absolute minimum.

| Operation Type                               | Use                     | Don't Use       |
| -------------------------------------------- | ----------------------- | --------------- |
| **Intellectual work** (reasoning, decisions) | AI + MCP tools          | Scripts         |
| **Mechanical operations** (API calls, CLI)   | Scripts (thin wrappers) | Complex scripts |

**Decision Tree**:

1. MCP tool exists? â†’ âœ… Use MCP (AI workflow)
2. Requires understanding? â†’ âœ… Use AI + prompts
3. Pure mechanical? â†’ âœ… Script OK (thin wrapper)

See: @110-ai-workflow.mdc

## TypeScript Strict Mode

| NEVER                 | ALWAYS                 |
| --------------------- | ---------------------- |
| `any` type            | `unknown` + type guard |
| `as` assertions       | Type guards            |
| `var` keyword         | `const` or `let`       |
| Implicit returns      | Explicit returns       |
| Redundant constraints | Default values only    |

**Type Guards Pattern**:

```typescript
const isUser = (x: unknown): x is User => typeof x === 'object' && x !== null && 'id' in x
```

**Record Types**: Use `Record<string, unknown>` over `Record<string, any>`.

## Immutability Rules

| Operation   | âŒ Mutation    | âœ… Immutable               |
| ----------- | -------------- | -------------------------- |
| Add item    | `arr.push(x)`  | `[...arr, x]`              |
| Remove item | `arr.pop()`    | `arr.slice(0,-1)`          |
| Sort        | `arr.sort()`   | `[...arr].sort()`          |
| Update prop | `obj.x = y`    | `{...obj, x: y}`           |
| Delete prop | `delete obj.x` | `const {x, ...rest} = obj` |

**React State**:

```typescript
setItems((prev) => [...prev, newItem]) // Add
setItems((prev) => prev.filter((i) => i.id !== id)) // Remove
setItems((prev) => prev.map((i) => (i.id === id ? { ...i, ...updates } : i))) // Update
```

## Code Quality Limits

| Metric     | Target     | Max | Critical |
| ---------- | ---------- | --- | -------- |
| File       | â‰¤150 lines | 300 | >300     |
| Component  | â‰¤150 lines | 300 | >300     |
| Function   | â‰¤30 lines  | 50  | >50      |
| Props      | â‰¤5         | 8   | >8       |
| Nesting    | â‰¤2 levels  | 3   | >3       |
| Cyclomatic | â‰¤5         | 10  | >10      |
| Coverage   | â‰¥95%       | 80% | <50%     |

## SOLID Principles

| Principle             | Rule                         |
| --------------------- | ---------------------------- |
| Single Responsibility | One component, one purpose   |
| Open/Closed           | Extend via composition       |
| Liskov Substitution   | Interchangeable by interface |
| Interface Segregation | Small, focused interfaces    |
| Dependency Inversion  | Depend on abstractions       |

## Import Rules

Use path aliases, never relative cross-layer imports:

```typescript
// âœ… Good
import { Button } from 'shared/ui'

// âŒ Bad
import { Button } from '../../../shared/ui'
```

**Aliases**: `shared/*`, `pages/*`, `widgets/*`, `entities/*`, `icons/*`

## Documentation Principles

| Type              | Location                                           |
| ----------------- | -------------------------------------------------- |
| Reports, research | Beads task description (`bd update --description`) |
| Current state     | `docs/*.md`                                        |
| AI rules          | `.cursor/rules/*.mdc`                              |
| ADR               | `docs/architecture/adr/`                           |
| Tasks             | Beads + Jira                                       |

**NEVER create**: `*-REPORT.md`, `*-ANALYSIS.md`, `*-REVIEW.md` (use Beads task description)

**ALWAYS use Beads task description for**: Temporary analysis, investigation notes, task planning

## Smart Suppression Policy

**CRITICAL**: Minimize manual suppressions (`eslint-disable`, `@ts-ignore`).

See: @119-suppressions.mdc

## TODO Comments

```typescript
// TODO(VP-123): Description
// FIXME(VP-456): Description - Priority
```

Always include Jira task key.

## Date Handling

**CRITICAL**: NEVER use `dayjs` directly. ALWAYS use `date` wrapper from `shared/date`.

```typescript
// âœ… Good
import { date, DateFormats } from 'shared/date'
date(value).format(DateFormats.DD_MM_YYYY)

// âŒ Bad
import dayjs from 'dayjs'
dayjs(value).format('DD.MM.YYYY')
```

## Language

**All code/comments/docs/commits**: English only. **Chat**: Russian allowed.

## Verification

**Before every push**: `npm run quality:gates`

**NEVER bypass** with `--no-verify` or `HUSKY=0`.

## Priority

1. Fix errors through refactoring (99%)
2. `eslint-disable-next-line` only with reason
3. Root cause over quick fix

## Code Review

Comments pointing to specific files = find similar issues across entire branch.

## File Analysis

| âœ… DO             | âŒ DON'T                    |
| ----------------- | --------------------------- |
| `read_file` tool  | Shell scripts for analysis  |
| `codebase_search` | `find` commands             |
| `grep` tool       | Script output for decisions |

## Beads Task Management

**ðŸ”´ CRITICAL CORE RULE**:

**ALWAYS use Beads for ALL planning, execution, and tracking. NEVER create markdown checklist files.**

### Why Beads First?

| Aspect             | Beads (âœ…)                     | Markdown Checklist (âŒ) |
| ------------------ | ------------------------------ | ----------------------- |
| **State tracking** | Ready/in_progress/done         | Manual status           |
| **Dependencies**   | Auto-managed                   | No tracking             |
| **Context**        | Full history                   | Scattered files         |
| **Visibility**     | `bd ready` shows work          | No visibility           |
| **Recovery**       | `bd list --status=in_progress` | No way to resume        |
| **Team**           | Syncs with git, accessible     | Local file only         |

### ALWAYS Use Beads For

**Planning**: Create Beads Epic â†’ Decompose into tasks
**Starting**: Create Beads Task (or claim existing)
**Multi-step**: Decompose into subtasks with dependencies
**Bugs**: Single Beads task per bug
**Refactoring**: One Beads task per area
**Features**: Beads Epic with component-level tasks
**Investigations**: Beads task with findings
**Code reviews**: Beads Epic â†’ Tasks per thread
**Documentation**: Beads task for documentation work
**Learning**: Beads task for reflection

### NEVER Create Markdown Checklists For

- âŒ Project-level plans (use Beads Epic instead)
- âŒ Feature checklists (use Beads Epic â†’ Tasks instead)
- âŒ Step-by-step guides in repository (use Beads Tasks instead)
- âŒ TODO.md or CHECKLIST.md files (use Beads exclusively)

### Workflow

**Planning**:

```bash
EPIC=$(bd create "Epic: [Title]" --type=epic -p 1)
bd create "Step 1: [Action]" --deps epic:$EPIC -p 1
```

**Execution**:

```bash
bd ready --json                    # Check ready work
bd update <id> --status=in_progress  # Claim
# ... do work ...
bd close <id> --reason="Completed"     # Complete
```

**Continuation**:

```bash
bd list --status=in_progress        # Find interrupted
bd show <id> --json                # Resume
```

**Completion**:

```bash
bd close <id> --reason="Completed" # Complete
bd create "Retrospective: [Topic]" --type=task -p 0 # Learn
bd sync                              # Sync
```

### Beads + MCPs Integration

**ALWAYS combine Beads with**:

- **Beads task description** - Store research, analysis, reports (all in task descriptions)
- **Hindsight MCP** - Learn from patterns, store lessons
- **Context7 MCP** - Research libraries, find solutions
- **Web Search MCP** - Find best practices

See: @111-context-management.mdc for MCP usage details.

**Core rule**: All planning and execution through Beads, no markdown checklists.

## Documentation Architecture

| Location           | Content                | Format |
| ------------------ | ---------------------- | ------ |
| `.cursor/rules/`   | AI rules (auto-loaded) | `.mdc` |
| `.cursor/prompts/` | AI commands (prompts)  | `.md`  |
| `docs/guides/`     | Human guides           | `.md`  |
| `docs/`            | Project documentation  | `.md`  |

**Rule**: Guides for humans â†’ `docs/guides/`, commands for AI â†’ `.cursor/prompts/`
